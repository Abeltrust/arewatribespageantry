<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Voting Results</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f5f5f5;
    }

    header {
        background: #2a2a72;
        color: white;
        padding: 20px;
        text-align: center;
        font-size: 24px;
        font-weight: bold;
    }

    .container {
        width: 95%;
        max-width: 900px;
        margin: 20px auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px #0002;
    }

    .title {
        font-size: 20px;
        margin-bottom: 10px;
        font-weight: bold;
    }

    .timer {
        font-size: 18px;
        color: #d9534f;
        margin-bottom: 20px;
        font-weight: bold;
        text-align: center;
    }

    #resultsTable {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    #resultsTable th, #resultsTable td {
        padding: 10px;
        border: 1px solid #ccc;
    }

    #resultsTable th {
        background: #2a2a72;
        color: #fff;
    }

    .admin-btn {
        display: inline-block;
        padding: 10px 16px;
        background: #d9534f;
        color: white;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 20px;
        font-weight: bold;
    }

    .admin-panel {
        display: none;
        margin-top: 20px;
        padding: 15px;
        border: 2px dashed #2a2a72;
        border-radius: 5px;
    }

    .hidden {
        display: none !important;
    }

    input[type="file"] {
        margin-top: 10px;
    }

    footer {
        margin-top: 30px;
        padding: 10px;
        text-align: center;
        color: #666;
        font-size: 14px;
    }
</style>
</head>

<body>

<header>Live Voting Results</header>

<div class="container">
    <div class="title">Contestants Ranking</div>

    <!-- Countdown -->
    <div id="countdown" class="timer">Loading countdown...</div>

    <!-- Results Table -->
    <table id="resultsTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Contestant Name</th>
                <th>Votes</th>
            </tr>
        </thead>
        <tbody id="resultsBody">
            <tr><td colspan="3" style="text-align:center;">Loading...</td></tr>
        </tbody>
    </table>

    <!-- Hidden Admin -->
    <div id="adminTrigger" style="width:40px; height:40px; opacity:0; position:fixed; bottom:10px; left:10px;"></div>

    <div id="adminPanel" class="admin-panel">
        <h3>Admin Control Panel</h3>
        <p>Upload New CSV:</p>
        <input type="file" id="csvFile" accept=".csv">
        <button onclick="uploadCSV()" class="admin-btn" style="background:#2a2a72;">Upload</button>
    </div>
</div>

<footer>Powered by Your Voting System Â© 2025</footer>


<script>
/* ---------------------------
   SECURITY SYSTEM (ADMIN LOGIN)
----------------------------- */

let adminUnlocked = false;
const ADMIN_PIN = "4321";  // Change this to any secret PIN

document.getElementById("adminTrigger").addEventListener("click", () => {
    if (!adminUnlocked) {
        let pin = prompt("Enter Admin PIN:");
        if (pin === ADMIN_PIN) {
            adminUnlocked = true;
            document.getElementById("adminPanel").style.display = "block";
            alert("Admin panel unlocked.");
        } else {
            alert("Incorrect PIN.");
        }
    }
});

/* ---------------------------
   COUNTDOWN TIMER
----------------------------- */

const eventDate = new Date("2025-12-30T23:59:59");

function updateCountdown() {
    const now = new Date();
    const diff = eventDate - now;

    if (diff <= 0) {
        document.getElementById("countdown").innerHTML = "Voting has ended.";
        return;
    }

    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hrs = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
    const mins = Math.floor((diff % (1000*60*60)) / (1000*60));
    const secs = Math.floor((diff % (1000*60)) / 1000);

    document.getElementById("countdown").innerHTML =
        `Ends in: ${days}d ${hrs}h ${mins}m ${secs}s`;
}

setInterval(updateCountdown, 1000);
updateCountdown();

/* ---------------------------
   LOAD CSV & DISPLAY RESULTS
----------------------------- */

function loadCSV() {
    fetch("results.csv")
        .then(response => response.text())
        .then(data => parseCSV(data));
}

function parseCSV(data) {
    const rows = data.trim().split("\n").slice(1);
    let html = "";

    rows.forEach(row => {
        const cols = row.split(",");
        html += `
            <tr>
                <td>${cols[0]}</td>
                <td>${cols[1]}</td>
                <td>${cols[2]}</td>
            </tr>`;
    });

    document.getElementById("resultsBody").innerHTML = html;
}

loadCSV();

/* ---------------------------
   ADMIN CSV UPLOAD (Local)
----------------------------- */

function uploadCSV() {
    const fileInput = document.getElementById("csvFile");
    if (!fileInput.files.length) {
        alert("Please select a CSV file.");
        return;
    }

    const file = fileInput.files[0];

    // Preview uploaded CSV without backend
    const reader = new FileReader();
    reader.onload = function(e) {
        parseCSV(e.target.result);
        alert("CSV Loaded (local preview).");
    };
    reader.readAsText(file);
}
</script>

</body>
</html>
